<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Vocab Quiz</title>
<style>
  :root { --fg:#111; --bg:#fafafa; --muted:#777; --accent:#2a73ff; --ok:#17a34a; --bad:#d33; --card:#fff; --border:#e6e6e6; }
  html,body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--fg)}
  .wrap{max-width:900px;margin:32px auto;padding:0 16px}
  header{display:flex;flex-wrap:wrap;align-items:center;gap:12px;justify-content:space-between;margin-bottom:16px}
  h1{font-size:20px;margin:0}
  .controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .pill{border:1px solid var(--border);background:var(--card);border-radius:999px;padding:6px 12px;font-size:14px}
  .pill.badge{border-color:#c7d2fe;background:#eef2ff}
  .switch{display:inline-flex;align-items:center;gap:8px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:12px;box-shadow:0 1px 0 rgba(0,0,0,.04);padding:20px}
  .q{font-size:20px;line-height:1.35;margin:0 0 14px}
  .meta{color:var(--muted);font-size:14px;margin-bottom:12px}
  .choices{display:grid;gap:10px}
  button.choice{all:unset;display:block;border:1px solid var(--border);background:var(--card);padding:12px 14px;border-radius:10px;cursor:pointer}
  button.choice:hover{border-color:#cfd7ff;background:#f6f8ff}
  button.choice.correct{border-color:var(--ok);background:#f0fbf4}
  button.choice.wrong{border-color:var(--bad);background:#fff5f5}
  .foot{display:flex;justify-content:space-between;align-items:center;margin-top:14px;gap:12px;flex-wrap:wrap}
  .feedback{font-size:18px;font-weight:700}
  .hide{display:none}
  .btn{all:unset;cursor:pointer;border:1px solid var(--border);background:var(--card);padding:8px 12px;border-radius:10px}
  .btn.primary{background:var(--accent);border-color:var(--accent);color:#fff}
  .btn:disabled{opacity:.5;cursor:not-allowed}
  .progress{height:8px;background:#eee;border-radius:999px;overflow:hidden}
  .bar{height:100%;background:var(--accent);width:0%}
  details summary{cursor:pointer}
  textarea{width:100%;min-height:120px;font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
  .small{font-size:12px;color:var(--muted)}
  /* Review dialog */
  dialog{border:none;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.15);padding:0;max-width:720px;width:min(92vw,720px)}
  .dlg-head{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;border-bottom:1px solid var(--border);background:var(--card)}
  .dlg-body{padding:10px 16px 16px;background:var(--card);max-height:min(70vh,580px);overflow:auto}
  .list{display:flex;flex-direction:column;gap:10px}
  .row{border:1px solid var(--border);border-radius:10px;padding:10px 12px;background:#fff}
  .row h4{margin:0 0 6px;font-size:15px}
  .row p{margin:0;font-size:14px}
  .row .mine{color:var(--bad)}
  .row .correct{color:var(--ok)}
  .row button.jump{margin-top:8px}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Vocab Quiz</h1>
      <div class="controls">
        <span class="pill" id="scorePill">Score: 0/0 0%</span>
        <span class="pill">Question <strong id="qnum">0</strong>/<span id="qcount">0</span></span>
        <span class="pill badge hide" id="modeBadge">Wrong-only mode</span>
        <label class="pill switch">
          <input type="checkbox" id="modeToggle" />
          <span>Definition → Term</span>
        </label>
        <button class="btn" id="wrongBtn" title="Review the ones you missed" disabled>Wrong (0)</button>
        <button class="btn" id="retakeWrongBtn" title="Mini-quiz of just your wrong answers" disabled>Retake Wrong Only</button>
        <button class="btn" id="shuffleBtn" title="New order">Shuffle</button>
        <button class="btn" id="restartBtn">Restart</button>
      </div>
    </header>

    <div class="progress" aria-hidden="true"><div class="bar" id="bar"></div></div>
    <div class="card" id="card">
      <div class="meta" id="meta"></div>
      <p class="q" id="question">Loading…</p>
      <div class="choices" id="choices"></div>
      <div class="foot">
        <div class="left">
          <div id="feedback" class="feedback hide"></div>
        </div>
        <div class="right">
          <button class="btn" id="prevBtn">Prev</button>
          <button class="btn primary" id="nextBtn">Next</button>
        </div>
      </div>
    </div>

    <details style="margin-top:18px">
      <summary>✏️ Edit / paste your own list (format: <em>Term - definition</em>)</summary>
      <p class="small">Paste below, one per line, like: <code>Acme – the highest point</code>. Then click “Load list”.</p>
      <textarea id="editor"></textarea>
      <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">
        <button class="btn" id="loadBtn">Load list</button>
        <button class="btn" id="downloadBtn">Download current as JSON</button>
      </div>
    </details>
  </div>

  <!-- Review wrong answers dialog -->
  <dialog id="wrongDlg">
    <div class="dlg-head">
      <strong>Review: Wrong Answers</strong>
      <button class="btn" id="closeWrong">Close</button>
    </div>
    <div class="dlg-body">
      <div id="wrongList" class="list"></div>
    </div>
  </dialog>

<script>
/* ====== DATA (you can paste your own in the editor) ====== */
const RAW = `
Acme - the highest point; peak; zenith.
Aesthetic - concerned with beauty or artistic taste.
Alacrity - cheerful readiness or eagerness.
Alternate - to occur in turn repeatedly
Ambiguous - unclear, open to multiple meanings.
Anachronism - something out of its proper historical time.
Approbation - approval or praise
Arbitrary - based on random choice, not reason
Ardor - enthusiasm or passion
Arrogate - to take without justification
Articulate - able to express clearly and effectively.
Assail - to attack vigorously, physically or verbally.
Austere - severe or strict in manner; plain
Audacious - showing a willingness to take bold risks
Augury - a sign of what will happen in the future; an omen
Axiomatic - self-evident or unquestionable
Banal - so lacking in originality as to be obvious and boring
Belfry - a bell tower
Berry - a group or cluster (archaic noun; less common word)
Bilq - to cheat or swindle
Blight - a plant disease; something that spoils
Blithe - showing casual indifference; carefree
Bolster - to support or strengthen
Bombastic - high-sounding but with little meaning
Cabal - a secret political clique or faction
Calumny - the making of false and defamatory statements
Canard - an unfounded rumor or story
Candid - truthful, straightforward, frank.
Capricious - impulsive, unpredictable, subject to whim.
Castigate - to criticize or punish harshly.
Catalyst - something that causes an event or change
Catholic - including a wide variety of things; universal
Chicanery - the use of trickery to achieve a purpose
Circumspect - wary and unwilling to take risks
Cloying - sickly sweet; excessively sentimental
Coalesce - to come together and form one whole
Cogent - clear, logical, and convincing
Coffer - a strongbox or small chest for holding valuables
Connoisseur - an expert judge in matters of taste.
Condone - to overlook, accept, or forgive wrongdoing.
Contrite - remorseful, feeling guilt or regret.
Convoluted - extremely complex or difficult to follow.
Cosset - to pamper; to treat with excessive indulgence
Coterie - a small, exclusive group of people with shared interests
Craven - contemptibly lacking in courage; cowardly
Credulous - too ready to believe; gullible
Crescendo - a gradual increase in intensity, volume, or force.
Cupidity - greed for money or possessions
Curmudgeon - a bad-tempered or surly person
Debutante - an upper-class young woman making her first appearance in fashionable society
Decorous - in keeping with good taste and propriety; polite and restrained
Decorum - behavior in keeping with good taste and propriety
Deface - to mar the appearance of; to vandalize.
Deference - respectful submission or yielding to another.
Demagogue - a political leader who seeks support by appealing to desires and prejudices rather than rational argument
Demur - to raise doubts or objections
Desultory - lacking a plan, purpose, or enthusiasm
Diaphanous - light, delicate, and translucent
Diatribe - a forceful and bitter verbal attack
Dichotomy - a division or contrast between two things
Dilemma - a situation requiring a difficult choice
Dilettante - a person with an amateur interest in the arts without real commitment
Dilatory - slow to act
Dirge - a mournful song, piece of music, or poem
Discern - to perceive or recognize clearly.
Disparate - essentially different in kind; not allowing comparison
Dissemble - to conceal one’s true motives, feelings, or beliefs
Dissonance - lack of harmony or agreement
Dogged - having or showing tenacity and grim persistence
Dogma - a principle laid down by an authority as incontrovertibly true
Dogmatic - inclined to lay down principles as incontrovertibly true
Droll - curious or unusual in a way that provokes amusement
Duplicity - deceitfulness; double-dealing
Ebullient - cheerful and full of energy
Eclectic - drawn from a wide variety of sources.
Edify - to instruct or improve morally or intellectually
Effigy - a sculpture or model of a person
Efficacy - the ability to produce a desired result
Eloquent - fluent and persuasive in speech or writing.
Emulate - to imitate with the intent to equal or surpass.
Encomium - a speech or piece of writing that praises highly
Enervate - to weaken or drain of energy
Engender - to cause or give rise to
Enigma - something puzzling or mysterious.
Enumerate - to list one by one
Epicure - a person who takes particular pleasure in fine food and drink
Ephemeral - lasting a very short time; fleeting.
Equivocate - to use ambiguous language to conceal the truth or avoid commitment
Erratic - unpredictable, inconsistent, irregular.
Eschew - to deliberately avoid or shun.
Esoteric - intended for or understood by only a small group.
Estimable - worthy of esteem; admirable
Ethos - the characteristic spirit of a culture, era, or community
Exculpate - to show or declare that someone is not guilty
Exigent - pressing; demanding
Exonerate - to absolve from blame or fault
Exponent - a person who believes in and promotes the truth or benefits of an idea or theory
Explic​it - stated clearly and in detail
Expurgate - to remove matter thought to be objectionable or unsuitable
Fervid - intensely enthusiastic or passionate
Ferret - to search tenaciously for something
Fetid - having a foul odor
Flout - to openly disregard (a rule or law)
Foment - to instigate or stir up
Forestall - to prevent by taking action ahead of time
Fortuitous - happening by chance; often fortunate.
Fractious - irritable and quarrelsome
Frenetic - fast and energetic in a rather wild way
Frugality - thriftiness; careful use of money or resources.
Furtive - secretive, sneaky, done to avoid notice.
Gainsay - to deny or contradict
Gambol - to run or jump about playfully
Garner - to gather or collect
Glib - fluent but insincere and shallow
Grandiloquent - pompous or extravagant in language
Gregarious - sociable, enjoying the company of others
Guile - sly or cunning intelligence.
Gullible - easily persuaded to believe something
Hapless - unfortunate
Harangue - a lengthy, aggressive speech
Hegemony - leadership or dominance, especially by one state or group
Homogeneous - of the same kind; alike
Iconoclast - a person who attacks cherished beliefs or institutions
Idiosyncrasy - a distinctive or peculiar feature or characteristic
Ignoble - not honorable in character or purpose
Imbue - to inspire or permeate with a feeling or quality
Imminent - about to happen
Immutable - unchanging over time
Impasse - a situation in which no progress is possible; deadlock
Impassive - unable to be upset or excited; calm
Imperious - assuming power without justification; arrogant
Impervious - not allowing passage; unaffected by.
Impetuous - acting quickly without thought; rash.
Implacable - relentless, unable to be appeased.
Imprecation - a spoken curse
Impugn - to dispute the truth or validity of something
Inadvertent - not resulting from deliberate planning; unintentional
Inane - silly, stupid
Inchoate - just begun and not fully formed; rudimentary
Incipient - in an initial stage, beginning to happen
Indolent - wanting to avoid activity; lazy
Ineffable - too great to be expressed in words
Ineluctable - unavoidable, inescapable
Inexorable - impossible to stop or prevent
Ingrate - an ungrateful person.
Inimical - harmful or hostile
Innocuous - harmless, inoffensive.
Inquisitive - curious or eager for knowledge
Inscrutable - impossible to understand or interpret
Insipid - lacking flavor; dull, boring
Insurrection - a violent uprising against authority
Intrepid - fearless, adventurous, bold.
Intransigent - unwilling or refusing to change one’s views
Inundate - to overwhelm with things or people to be dealt with; flood
Invective - insulting, abusive, or highly critical language
Inveigh - to speak or write about with hostility
Invidious - likely to arouse resentment or anger in others
Irascible - easily angered
Irresolute - showing or feeling hesitancy; uncertain
Itinerant - traveling from place to place
Keen - sharp, perceptive; eager.
Kindle - to start a fire; to inspire or ignite (emotion/idea).
Laconic - using very few words
Languid - displaying a disinclination for physical exertion; slow and relaxed
Larceny - theft of personal property.
Largesse - generosity in bestowing money or gifts upon others
Latent - existing but not yet developed or manifest; hidden
Laud - to praise highly
Lavish - sumptuously rich, elaborate, or luxurious
Levity - lack of seriousness, often in a humorous way.
Lethargic - sluggish, lacking energy.
Limpid - clear, transparent
Lionize - to treat as a celebrity
Loquacious - very talkative, chatty.
Lucid - expressed clearly; easy to understand
Lugubrious - looking or sounding sad and dismal
Luminous - emitting light; bright or radiant.
Machination - a plot or scheme
Maelstrom - a powerful whirlpool; a situation of confused movement or turmoil
Magnanimous - generous or forgiving, especially toward a rival or less powerful person
Magnate - a wealthy and influential person, especially in business
Malediction - a magical word or phrase uttered with the intention of bringing about evil; a curse
Malevolent - having or showing a wish to do evil to others
Malinger - to exaggerate or feign illness in order to escape duty or work
Malign - to speak about (someone) in a spitefully critical manner
Malleable - easily shaped or influenced.
Mar - to impair the appearance or quality of; spoil
Maudlin - self-pityingly sentimental, often through drunkenness
Mawkish - sentimental in a feeble or sickly way
Mendacious - lying; untruthful
Mercurial - subject to sudden or unpredictable changes of mood or mind
Meretricious - apparently attractive but having no real value or integrity
Meticulous - extremely careful and precise.
Misanthrope - a person who dislikes humankind and avoids human society
Mitigate - to make less severe, serious, or painful
Mollify - to appease the anger or anxiety of someone
Monastic - relating to monks or monasteries; simple, austere
Monotony - tedious sameness; lack of variety.
Morose - sullen, gloomy, ill-tempered
Multifarious - many and of various types
Munificent - larger or more generous than usual or necessary
Myopic - nearsighted; lacking foresight or intellectual insight
Nadir - the lowest point; rock bottom.
Nascent - just coming into existence and beginning to display signs of future potential
Neologism - a newly coined word or expression
Neophyte - a person new to a subject, skill, or belief
Nuance - a subtle distinction or variation.
Obdurate - stubbornly refusing to change one’s opinion or course of action
Obfuscate - to render obscure, unclear, or unintelligible
Obstinate - stubbornly refusing to change despite attempts to persuade
Obviate - to remove a need or difficulty; to avoid
Occlude - to block or stop up
Onerous - burdensome, difficult, oppressive.
Opine - to state an opinion.
Opprobrium - harsh criticism or censure; public disgrace
Ostensible - stated or appearing to be true, but not necessarily so
Ostentation - pretentious and vulgar display intended to impress
Overweening - showing excessive confidence or pride
Overwrought - in a state of nervous excitement or anxiety
Palliate - to relieve symptoms without removing the cause
Pallid - pale, typically because of poor health
Panacea - a solution or remedy for all difficulties or diseases
Panegyric - a public speech or published text in praise of someone or something
Paradox - a seemingly self-contradictory statement that may hold truth.
Paragon - a perfect example of a quality or excellence
Parry - to ward off (a blow, criticism, or attack).
Parsimony - extreme unwillingness to spend money or use resources
Pastiche - an artistic work imitating another style or period
Pathogenic - causing or capable of causing disease
Peccadillo - a minor fault or sin
Pedant - a person excessively concerned with minor details or rules
Penchant - a strong or habitual liking for something
Penury - extreme poverty
Peregrinate - to travel or wander from place to place
Perfidy - deceitfulness; untrustworthiness
Perfidious - deceitful, treacherous, untrustworthy.
Perfunctory - done with minimal effort; superficial.
Peruse - to read thoroughly or carefully
Perspicacious - having a ready insight into and understanding of things
Perspicuous - clearly expressed and easily understood
Philistine - a person indifferent or hostile to culture and the arts
Phlegmatic - having an unemotional and stolidly calm disposition
Pithy - concise and forcefully expressive
Placate - to soothe or appease someone’s anger.
Plethora - an excess of something
Pragmatic - practical, focused on real-world solutions.
Precarious - not securely held; dangerously likely to fall or collapse
Precipitate - cause to happen suddenly or prematurely; (adj.) done without careful consideration
Precursor - a forerunner; something that comes before another of the same kind
Prevaricate - to speak or act in an evasive way
Probity - the quality of having strong moral principles; honesty
Proclivity - natural inclination toward something
Proliferate - to multiply or spread rapidly.
Propriety - conformity to conventionally accepted standards of behavior
Proscribe - to forbid, especially by law
Proselytize - to try to convert someone to a faith
Propitiate - to win or regain favor by doing something pleasing
Propitious - favorable; giving a good chance of success
Quiescent - in a state of inactivity or dormancy
Querulous - complaining in a whining manner
Quotidian - of or occurring every day; ordinary
Rarefy - to make less dense or more refined
Recalcitrant - having an obstinately uncooperative attitude
Rejoinder - a reply, especially a sharp or witty one
Repudiate - to refuse to accept or be associated with
Reprobate - an unprincipled person
Requite - to make appropriate return for (a favor, service, or wrongdoing)
Reticent - not revealing one’s thoughts or feelings readily
Rhetoric - the art of effective or persuasive speaking or writing
Rococo - extravagantly ornate, highly decorated.
Rustic - simple, rural, unsophisticated.
Sagacious - wise, shrewd, showing good judgment.
Salubrious - health-giving, wholesome.
Sanguine - optimistic or positive, especially in a bad situation
Sardonic - grimly mocking or cynical
Sedition - conduct or speech inciting people to rebel against authority
Seraphic - characteristic of or resembling an angel
Sinecure - a position requiring little or no work but giving status or benefits
Specious - superficially plausible but actually wrong
Spartan - showing indifference to comfort or luxury; austere
Spurious - false or fake
Stigma - a mark of disgrace associated with a particular circumstance or quality
Stolid - calm, dependable, showing little emotion
Stratagem - a plan or scheme, especially one used to outwit an opponent
Stymie - to prevent or hinder progress
Sublime - of such excellence or beauty as to inspire awe
Supplant - to replace or supersede
Surfeit - an excessive amount
Surly - bad-tempered and unfriendly
Symbiosis - a mutually beneficial relationship.
Sybarite - a person who is self-indulgent in their fondness for luxury
Tacit - understood without being stated; implied
Taciturn - reserved or uncommunicative in speech
Tangential - only slightly connected; digressive
Tenet - a principle or belief
Tawdry - showy but cheap and of poor quality
Terrestrial - of, on, or relating to the earth
Tirade - a long, angry speech of criticism or accusation
Toady - a person who flatters or ingratiates themselves with someone important
Torrid - very hot and dry; full of difficulty or tribulation; passionate
Trenchant - vigorous or incisive in expression or style
Truculent - eager or quick to argue or fight; aggressively defiant
Turgid - swollen and distended; tediously pompous
Tyro - a beginner or novice
Ubiquitous - present, appearing, or found everywhere
Umbrage - offense or annoyance
Unconscionable - not right or reasonable; unreasonably excessive
Unequivocal - leaving no doubt; unambiguous
Upbraid - to scold or criticize
Usury - the illegal action of lending money at unreasonably high rates of interest
Vacillate - to waver between options; be indecisive.
Venerable - accorded a great deal of respect, especially because of age, wisdom, or character
Veracity - conformity to facts; accuracy; truthfulness
Verbose - using more words than necessary; wordy.
Verdant - green with vegetation; lush.
Vernal - related to spring; fresh, youthful
Vestige - a trace or remnant of something that is disappearing or no longer exists
Vex - to annoy, frustrate, or worry
Vicissitude - a change of circumstances or fortune, typically one that is unwelcome or unpleasant
Viscous - having a thick, sticky consistency between solid and liquid
Vituperate - to blame or insult (someone) in strong or violent language
Volatile - liable to change rapidly and unpredictably, especially for the worse
Voluble - speaking fluently, readily, or incessantly
Wan - pale, weak, or exhausted
Wanton - deliberate and unprovoked; reckless
Whimsical - playfully fanciful or unpredictable.
Wily - crafty, clever at gaining advantage.
Winsome - attractive or appealing in appearance or character
Wraith - a ghost or ghostlike image of someone
Xenophobia - dislike of or prejudice against people from other countries
Yoke - to join together; to harness or bind
Zephyr - a soft, gentle breeze

`.trim();

/* ====== Parser: accept -, – , — between term and definition ====== */
function parseList(str){
  return str.split(/\r?\n/).map(rawLine=>{
    const line = rawLine.trim();
    if(!line) return null;
    const m = line.split(/\s*[-–—]\s*/); // hyphen, en dash, em dash
    if(m.length < 2) return null;
    const term = m.shift().trim();
    const def = m.join(' - ').trim();
    return term && def ? {term, def} : null;
  }).filter(Boolean);
}

let DATA = parseList(RAW);

/* ====== UI refs ====== */
const qEl = document.getElementById('question');
const metaEl = document.getElementById('meta');
const choicesEl = document.getElementById('choices');
const feedbackEl = document.getElementById('feedback');
const qnumEl = document.getElementById('qnum');
const qcountEl = document.getElementById('qcount');
const barEl = document.getElementById('bar');
const scorePill = document.getElementById('scorePill');
const modeBadge = document.getElementById('modeBadge');

const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const restartBtn = document.getElementById('restartBtn');
const shuffleBtn = document.getElementById('shuffleBtn');
const modeToggle = document.getElementById('modeToggle');

const editor = document.getElementById('editor');
const loadBtn = document.getElementById('loadBtn');
const downloadBtn = document.getElementById('downloadBtn');

const wrongBtn = document.getElementById('wrongBtn');
const retakeWrongBtn = document.getElementById('retakeWrongBtn');
const wrongDlg = document.getElementById('wrongDlg');
const wrongList = document.getElementById('wrongList');
const closeWrong = document.getElementById('closeWrong');

/* ====== State ====== */
let order = [];          // indices into DATA for current deck
let idx = 0;             // current position in 'order'
let score = 0;           // number correct
let answered = new Map();// index -> {correct:boolean, pick:string}
let forwardMode = true;  // true: term->def, false: def->term
let wrongOnly = false;   // whether we're in the wrong-only mini-quiz

/* ====== Utils ====== */
function shuffle(a){
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}
function makeFullOrder(){ order = shuffle([...DATA.keys()]); }
function answeredCount(){ return answered.size; }
function wrongIndices(){
  return [...answered.entries()].filter(([i,res]) => !res.correct).map(([i]) => i);
}
function percent(){
  const a = answeredCount();
  return a === 0 ? 0 : Math.floor((score / a) * 100);
}
function updateHeader(){
  const a = answeredCount();
  scorePill.textContent = `Score: ${score}/${a} ${percent()}%`;
  qcountEl.textContent = order.length;
  qnumEl.textContent = Math.min(idx+1, order.length);
  barEl.style.width = `${Math.round((idx)/Math.max(1,order.length)*100)}%`;

  const w = wrongIndices().length;
  wrongBtn.textContent = `Wrong (${w})`;
  wrongBtn.disabled = w === 0;
  retakeWrongBtn.disabled = w === 0;

  modeBadge.classList.toggle('hide', !wrongOnly);
}
function buildChoices(i){
  const correct = DATA[i];
  const pool = DATA.map(x => forwardMode ? x.def : x.term);
  const correctText = forwardMode ? correct.def : correct.term;
  const wrongs = [];
  const used = new Set([correctText]);
  while(wrongs.length < 4){
    const pick = pool[Math.floor(Math.random()*pool.length)];
    if(!used.has(pick)){ wrongs.push(pick); used.add(pick); }
  }
  const options = shuffle([correctText, ...wrongs]);
  return {options, correctText};
}

/* ====== Rendering ====== */
function render(){
  if(order.length===0){ qEl.textContent = 'No items loaded.'; return; }
  updateHeader();
  const i = order[idx];
  const item = DATA[i];
  const prompt = forwardMode ? item.term : item.def;
  const {options, correctText} = buildChoices(i);

  metaEl.textContent = forwardMode ? 'Pick the correct definition.' : 'Pick the correct term.';
  qEl.textContent = prompt;

  choicesEl.innerHTML = '';
  options.forEach(opt=>{
    const btn = document.createElement('button');
    btn.className = 'choice';
    btn.textContent = opt;
    btn.onclick = ()=>handlePick(opt, correctText);
    const was = answered.get(i);
    if(was){
      btn.disabled = true;
      if(opt===correctText) btn.classList.add('correct');
      if(was.pick===opt && !was.correct) btn.classList.add('wrong');
    }
    choicesEl.appendChild(btn);
  });

  const was = answered.get(i);
  if(was){
    feedbackEl.textContent = was.correct ? '✅ Correct!' : '❌ Incorrect. Correct answer shown in green.';
    feedbackEl.classList.remove('hide');
  } else {
    feedbackEl.textContent = '';
    feedbackEl.classList.add('hide');
  }

  prevBtn.disabled = (idx===0);
  nextBtn.textContent = (idx===order.length-1) ? 'Finish' : 'Next';
}

/* ====== Handlers ====== */
function handlePick(pick, correctText){
  const i = order[idx];
  if(answered.has(i)) return;
  const isCorrect = pick === correctText;
  answered.set(i, {correct:isCorrect, pick});
  if(isCorrect) score++;

  document.querySelectorAll('button.choice').forEach(b=>{
    b.disabled = true;
    if(b.textContent===correctText) b.classList.add('correct');
    if(b.textContent===pick && !isCorrect) b.classList.add('wrong');
  });

  feedbackEl.textContent = isCorrect ? '✅ Correct!' : '❌ Incorrect. Correct answer shown in green.';
  feedbackEl.classList.remove('hide');
  updateHeader();
}

prevBtn.onclick = ()=>{ if(idx>0){ idx--; render(); } };
nextBtn.onclick = ()=>{
  if(idx < order.length-1){
    idx++; render();
  } else {
    qEl.textContent = `Done! Score: ${score}/${answeredCount()} ${percent()}%.`;
    metaEl.textContent = wrongOnly ? 'Wrong-only mini-quiz complete.' : 'Quiz complete.';
    choicesEl.innerHTML = '';
    feedbackEl.textContent = '';
    feedbackEl.classList.add('hide');
    prevBtn.disabled = false;
    nextBtn.disabled = true;
    updateHeader();
  }
};

function resetStateForNewDeck(){
  idx = 0;
  score = 0;
  answered.clear();
}
function startFullDeck(){
  wrongOnly = false;
  makeFullOrder();
  resetStateForNewDeck();
  render();
}
function startWrongOnly(){
  const wrongs = wrongIndices();
  if(wrongs.length === 0) return;
  wrongOnly = true;
  order = shuffle([...wrongs]);
  resetStateForNewDeck();
  render();
}

restartBtn.onclick = startFullDeck;
shuffleBtn.onclick = startFullDeck;
retakeWrongBtn.onclick = startWrongOnly;

modeToggle.onchange = ()=>{
  forwardMode = !forwardMode;
  // keep current deck (full or wrong-only) but reset progress
  resetStateForNewDeck();
  render();
};

/* ====== Wrong review dialog ====== */
wrongBtn.onclick = ()=>{
  buildWrongList();
  if(typeof wrongDlg.showModal === 'function'){ wrongDlg.showModal(); }
  else { wrongDlg.setAttribute('open','open'); }
};
closeWrong.onclick = ()=> wrongDlg.close();
function buildWrongList(){
  wrongList.innerHTML = '';
  const wrongs = wrongIndices();
  if(wrongs.length === 0){
    wrongList.innerHTML = '<p class="small">Nothing to review—nice!</p>';
    return;
  }
  wrongs.forEach(i=>{
    const item = DATA[i];
    const res = answered.get(i);
    const correctText = forwardMode ? item.def : item.term;
    const prompt = forwardMode ? item.term : item.def;
    const li = document.createElement('div');
    li.className = 'row';
    li.innerHTML = `
      <h4>${prompt}</h4>
      <p class="mine">Your answer: ${res.pick}</p>
      <p class="correct">Correct: ${correctText}</p>
    `;
    const jump = document.createElement('button');
    jump.className = 'btn jump';
    jump.textContent = 'Jump to this question';
    jump.onclick = ()=>{
      const pos = order.indexOf(i);
      if(pos !== -1){ idx = pos; render(); wrongDlg.close(); }
      else {
        // If the item isn't in the current deck, switch to full deck and jump
        wrongDlg.close();
        wrongOnly = false;
        makeFullOrder();
        idx = order.indexOf(i);
        if(idx === -1){ order.unshift(i); idx = 0; }
        resetStateForNewDeck();
        render();
      }
    };
    li.appendChild(jump);
    wrongList.appendChild(li);
  });
}

/* ====== Editor / import-export ====== */
editor.value = RAW;
loadBtn.onclick = ()=>{
  const parsed = parseList(editor.value);
  if(parsed.length===0){ alert('Could not parse any “Term - definition” lines.'); return; }
  DATA = parsed;
  startFullDeck();
};
downloadBtn.onclick = ()=>{
  const blob = new Blob([JSON.stringify(DATA,null,2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'vocab.json';
  a.click();
  URL.revokeObjectURL(url);
};

/* ====== Init ====== */
startFullDeck();
</script>
</body>
</html>
